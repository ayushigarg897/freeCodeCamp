FROM node:12.20
ENV MONGOHQ_URL='mongodb://127.0.0.1:27017/freecodecamp'
WORKDIR /root
COPY . .
# TODO: pass in the secrets
# TODO: dockerignore .env and make 100% sure all the ignored files don't get
# transferred across (including node_modules and any build artifacts)
RUN npm ci
# TODO: we currently can babelify the files and put them in the /lib dir, which
# we do.  However, the production api doesn't currently use them.  Should it? As
# far as I can see it saves us a bit by removing tests, but is that worth it? If
# we used a bundler (webpack for node?) we should be able to avoid installing
# the entire repo everywhere we just need the api, but that would make the
# babelification redundant.
WORKDIR api-server
# TODO: make the db available (docker-compose?)
CMD ["npm", "start"]
